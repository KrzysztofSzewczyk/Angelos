#!/bin/bash -e

if [ ! -f ~/.asmbf ]; then
	echo "Error: asm2bf not installed properly."
	exit 1
fi

bench=$(cat ~/.asmbf)

if [ "$1" == "-no-strip" ]; then
	{ cat "${bench}lib/lib-bfm.lua" ; cat "$2" | sed -e "1!b" -e '/#/d' ; } | "${bench}bfpp" | "${bench}bflabels" | "${bench}bfdata" | sed '/^#/ d' | "${bench}bfasm" > "${2%.*}.b"
else
	{ cat "${bench}lib/lib-bfm.lua" ; cat "$1" | sed -e "1!b" -e '/#/d' ; } | "${bench}bfpp" | "${bench}bflabels" | "${bench}bfdata" | sed '/^#/ d' | "${bench}bfasm" | "${bench}bfstrip" > "${1%.*}.b"
fi
