
; Don't ask questions, this is beyond explaining








; Some common defines






; gcd, cgc, cre



; floating point







; Conditional instructions













































; Allocate a page and pass the pointer in target_register.
; This function has a side effect on register passed in clear.
; It's getting, simply, cleared.

; Free the page in target_register.
	

; Example RedPower kernel.
; Released to the Public domain.

; Kernel base adress, 1M.


; Brainfuck tape base adress, right at the 16M mark.


; Video memory base adress.


; Loading the BIOS driver.
nav r1
raw .<
raw .8
raw .3
raw .8
raw .7
raw .4
raw .6
raw .0
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .5
raw .7
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .6
raw .0
raw .0
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .3
raw .0
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .8
raw .4
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .9
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .5
raw .0
raw .2
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .1
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .0
raw .9
raw .5
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .2
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .6
raw .6
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .9
raw .6
raw .5
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .1
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .4
raw .1
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .9
raw .9
raw .8
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .6
raw .0
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .5
raw .6
raw .2
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .6
raw .1
raw .9
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .3
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .7
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .0
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .6
raw .8
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .3
raw .6
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .3
raw .9
raw .2
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .5
raw .2
raw .9
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .9
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .4
raw .1
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .0
raw .0
raw .1
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .3
raw .5
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .5
raw .6
raw .1
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .6
raw .1
raw .9
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .5
raw .3
raw .6
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .7
raw .6
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .0
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .6
raw .8
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .7
raw .5
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .1
raw .7
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .9
raw .3
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .4
raw .1
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .9
raw .9
raw .8
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .0
raw .1
raw .6
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .9
raw .2
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .3
raw .5
raw .3
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .5
raw .3
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .4
raw .0
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .0
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .4
raw .7
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .0
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .7
raw .9
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .7
raw .5
raw .3
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .3
raw .2
raw .5
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .8
raw .3
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .4
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .7
raw .1
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .4
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .8
raw .1
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .4
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .0
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .3
raw .0
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .3
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .3
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .7
raw .5
raw .3
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .3
raw .2
raw .5
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .8
raw .3
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .3
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .7
raw .1
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .5
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .8
raw .1
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .5
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .0
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .2
raw .5
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .5
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .8
raw .8
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .7
raw .5
raw .3
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .3
raw .2
raw .5
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .8
raw .3
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .7
raw .1
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .6
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .8
raw .1
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .0
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .2
raw .1
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .4
raw .0
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .6
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .9
raw .3
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .7
raw .5
raw .3
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .3
raw .2
raw .5
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .8
raw .3
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .7
raw .1
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .6
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .9
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .8
raw .1
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .7
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .0
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .3
raw .2
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .2
raw .2
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .7
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .5
raw .4
raw .4
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .0
raw .9
raw .7
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .1
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .7
raw .3
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .7
raw .3
raw .2
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .7
raw .8
raw .1
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .4
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .6
raw .8
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .1
raw .3
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .7
raw .7
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .3
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .6
raw .8
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .1
raw .2
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .6
raw .0
raw .1
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .2
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .6
raw .8
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .0
raw .7
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .4
raw .0
raw .7
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .1
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .4
raw .7
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .2
raw .6
raw .3
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .1
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .0
raw .0
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .6
raw .7
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .7
raw .3
raw .3
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .7
raw .8
raw .1
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .4
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .1
raw .7
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .1
raw .3
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .7
raw .6
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .3
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .1
raw .7
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .1
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .3
raw .9
raw .6
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .8
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .1
raw .7
raw .4
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .0
raw .7
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .1
raw .2
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .7
raw .3
raw .2
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .3
raw .0
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .4
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .4
raw .4
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .2
raw .8
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .4
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .6
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .2
raw .5
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .5
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .4
raw .9
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .2
raw .3
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .5
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .5
raw .1
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .2
raw .0
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .5
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .5
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .1
raw .8
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .5
raw .6
raw .3
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .6
raw .1
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .1
raw .7
raw .3
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .3
raw .5
raw .8
raw .6
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .5
raw .1
raw .0
raw .>
raw .[
raw .-
raw .]
raw .+
raw .4
raw .3
raw .2
raw .8
raw .>
raw .[
raw .-
raw .]
raw .+
raw .7
raw .5
raw .8
raw .7
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .6
raw .2
raw .5
raw .2
raw .>
raw .[
raw .-
raw .]
raw .+
raw .2
raw .4
raw .9
raw .3
raw .5
raw .>
raw .[
raw .-
raw .]
raw .+
raw .1
raw .9
raw .5
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .>
raw .[
raw .-
raw .]
raw .+
raw .5
raw .3
raw .0
raw .8
raw .9
raw .>
raw .[
raw .-
raw .]
raw .+
raw .6
raw .5
raw .5
raw .3
raw .5
raw .>
raw .[
raw .-
raw .]
raw .>
raw .>
raw .8
raw .3
raw .8
raw .7
raw .1
raw .8
raw .6
nav r1
raw .<
raw .8
raw .3
raw .8
raw .7
raw .4
raw .6
raw .1
raw .[
raw .-
raw .]
raw .+
raw .4
raw .9
raw .1
raw .>
raw .8
raw .3
raw .8
raw .7
raw .4
raw .6
raw .1


; I/O stack helpers


; Set up a 16 word stack.
stk 32
org 0

; Generate a table of interrupt parameters.

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0

db 0


; Wait until the driver installs itself.
lbl 1

    mov r1, 1337
    raw .!
    clr r1
    raw .?
    ceq r1, 1337
    cjn 1


txt "'The cat is purring, it scratches my skin.\n\r So what is wrong with another sin?'"
db 0

mov r1, 16
mov r2, 12

psh 2
jmp 3
lbl 2


end

; -----------------------------------------------------------------------
; Display a string.
; r1 => string pointer, terminated with a nul.
; r2 => the color.
; Clobbers r1 and r3.
lbl 3

    rcl r3, r1
    jz r3, 4
    swp r1, r3
psh 5
jmp 6
lbl 5

    swp r1, r3
    inc r1
    jmp 3
lbl 4

    out 10
    ret

; -----------------------------------------------------------------------
; Display a character.
; Obviously all the clutter above can be simplified, but we want to stay
; descriptive for now.

; r1 => character
; r2 => color
lbl 6

    ; eax = 00000E30h

mov f3, 0
sto f3, 0


    ; Note: you HAVE to use vxcall here, either that or ots.
    ;       The ots approach may be more performant.
    add r1, 3584

mov f3, 1
sto f3, r1

    sub r1, 3584

    ; ebx = 0000000Ch

mov f3, 2
sto f3, 0


mov f3, 3
sto f3, r2


    ; ecx = 0000000Ch

mov f3, 4
sto f3, 0


mov f3, 5
sto f3, 0


    ; edx = 0000000Ch

mov f3, 6
sto f3, 0


mov f3, 7
sto f3, 0


    ; esi = 0000000Ch

mov f3, 8
sto f3, 0


mov f3, 9
sto f3, 0


    ; edi = 0000000Ch

mov f3, 10
sto f3, 0


mov f3, 11
sto f3, 0


    ; ebp = 0000000Ch

mov f3, 12
sto f3, 0


mov f3, 13
sto f3, 0


    ; eflags = 0000000Ch

mov f3, 14
sto f3, 0


mov f3, 15
sto f3, 0


    ; BIOS function 0x10
    mov r1, 16

    psh 7
jmp 8
lbl 7


    ret

; -----------------------------------------------------------------------
; Fire an interrupt.
; Takes input via global variables, stores the state in a separate
; structure. The interrupt vector is accepted in `r1'.

; Possible bugs: Doesn't save/restore high eax bits or low eflags bits.

; I/O stack state _before_ the interrupt:

;  top                                                            bottom
;  +-----+--------+-----+-----+-----+-----+-----+-----+-----+----------+
;  | vec | eflags | ebp | edi | esi | edx | ecx | ebx | eax | function | 
;  +-----+--------+-----+-----+-----+-----+-----+-----+-----+----------+
; 36    34       30    26    22    18    14    10     6     2          0
;         \-------------------------------------------------/
;          encoded as two stack elements, where each slot is
;               represented with it's highest bits low.

; I/O stack state _after_ the interrupt:

;  top                                           bottom
;  +--------+-----+-----+-----+-----+-----+-----+-----+
;  | eflags | ebp | edi | esi | edx | ecx | ebx | eax |
;  +--------+-----+-----+-----+-----+-----+-----+-----+
; 32       28    24    20    16    12     8     4     0

lbl 8

    swp r1, r3
    psh r1
    psh r2
    mov f3, 1
nav f3
raw .!

    mov r2, 0
lbl 9

    rcl r1, r2
    nav r1
raw .!

    cge r2, 15
    inc r2
    cjz 9
    nav r3
raw .!

    raw .#

    nav r1
raw .?

    nav r1
raw .?

    mov r2, 15
lbl 10

    nav r1
raw .?

    sto r2, r1
    ceq r2, 0
    dec r2
    cjz 10
    pop r2
    pop r1
    swp r3, r1
    ret
